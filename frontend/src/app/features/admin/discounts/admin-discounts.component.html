<div class="admin-discounts-container">
    <div class="header">
        <h1>Qu·∫£n l√Ω M√£ gi·∫£m gi√° & Flash Sale</h1>
        <button class="btn-add" (click)="openCreateForm()">+ Th√™m m·ªõi</button>
    </div>

    <!-- Discount List -->
    <div class="table-container">
        <table>
            <thead>
                <tr>
                    <th>M√£ Code</th>
                    <th>Lo·∫°i</th>
                    <th>Gi√° tr·ªã</th>
                    <th>√Åp d·ª•ng cho</th>
                    <th>Th·ªùi gian</th>
                    <th>Gi·ªõi h·∫°n</th>
                    <th>ƒê√£ d√πng</th>
                    <th>Tr·∫°ng th√°i</th>
                    <th>H√†nh ƒë·ªông</th>
                </tr>
            </thead>
            <tbody>
                <tr *ngFor="let discount of discounts()">
                    <td>
                        <span class="code-badge">{{ discount.code }}</span>
                        <div *ngIf="discount.appliesToProductId" class="flash-sale-badge">‚ö° Flash Sale</div>
                    </td>
                    <td>{{ discount.discountType === 'Percent' ? 'Ph·∫ßn trƒÉm' : 'S·ªë ti·ªÅn' }}</td>
                    <td class="value">
                        {{ discount.discountType === 'Percent' ? discount.value + '%' : (discount.value | number) + 'ƒë'
                        }}
                    </td>
                    <td>
                        {{ getProductName(discount.appliesToProductId) }}
                        <div class="min-order" *ngIf="discount.minimumOrderAmount > 0">
                            Min: {{ discount.minimumOrderAmount | number }}ƒë
                        </div>
                    </td>
                    <td class="validity">
                        <div>{{ discount.startDate | date:'dd/MM/yy HH:mm' }}</div>
                        <div class="arrow">‚Üì</div>
                        <div>{{ discount.endDate | date:'dd/MM/yy HH:mm' }}</div>
                    </td>
                    <td>{{ discount.usageLimit === 0 ? '‚àû' : discount.usageLimit }}</td>
                    <td>{{ discount.usedCount }}</td>
                    <td>
                        <span class="status-badge" [class.active]="discount.isActive"
                            [class.inactive]="!discount.isActive">
                            {{ discount.isActive ? 'Active' : 'Inactive' }}
                        </span>
                    </td>
                    <td class="actions">
                        <button class="btn-icon edit" (click)="editDiscount(discount)" title="S·ª≠a">‚úé</button>
                        <button class="btn-icon delete" (click)="deleteDiscount(discount.id)" title="X√≥a">üóë</button>
                    </td>
                </tr>
                <tr *ngIf="discounts().length === 0">
                    <td colspan="9" class="empty-state">Ch∆∞a c√≥ m√£ gi·∫£m gi√° n√†o</td>
                </tr>
            </tbody>
        </table>
    </div>

    <!-- Form Modal -->
    <div class="modal-overlay" *ngIf="showForm()">
        <div class="modal-content">
            <div class="modal-header">
                <h2>{{ isEditing() ? 'C·∫≠p nh·∫≠t M√£ gi·∫£m gi√°' : 'T·∫°o M√£ gi·∫£m gi√° m·ªõi' }}</h2>
                <button class="btn-close" (click)="cancelForm()">√ó</button>
            </div>
            <div class="modal-body">
                <form (ngSubmit)="onSubmit()" #discountForm="ngForm">
                    <div class="form-group info-box">
                        <label>Lo·∫°i ch∆∞∆°ng tr√¨nh</label>
                        <div class="radio-group">
                            <label>
                                <input type="radio" name="programType" [value]="null"
                                    [(ngModel)]="formModel.appliesToProductId"
                                    (change)="formModel.appliesToProductId = null">
                                M√£ gi·∫£m gi√° th∆∞·ªùng (Cho ƒë∆°n h√†ng)
                            </label>
                            <label>
                                <input type="radio" name="programType" [value]="1"
                                    [checked]="formModel.appliesToProductId !== null">
                                Flash Sale (Gi·∫£m gi√° s·∫£n ph·∫©m)
                            </label>
                        </div>
                    </div>

                    <div class="form-row" *ngIf="formModel.appliesToProductId !== null">
                        <div class="form-group full-width">
                            <label>Ch·ªçn s·∫£n ph·∫©m Flash Sale</label>
                            <select name="appliesToProductId" [(ngModel)]="formModel.appliesToProductId" required
                                class="form-control">
                                <option [ngValue]="null">-- Ch·ªçn s·∫£n ph·∫©m --</option>
                                <option *ngFor="let p of products()" [ngValue]="p.id">{{ p.name }} (Gi√° g·ªëc: {{ p.price
                                    | number }}ƒë)</option>
                            </select>
                        </div>
                    </div>

                    <div class="form-row">
                        <div class="form-group">
                            <label>M√£ Code</label>
                            <input type="text" name="code" [(ngModel)]="formModel.code"
                                [placeholder]="formModel.appliesToProductId ? 'T·ª± ƒë·ªông t·∫°o n·∫øu ƒë·ªÉ tr·ªëng' : 'Nh·∫≠p m√£ (VD: SALE50)'"
                                class="form-control" [required]="!formModel.appliesToProductId">
                        </div>
                        <div class="form-group">
                            <label>Lo·∫°i gi·∫£m gi√°</label>
                            <select name="discountType" [(ngModel)]="formModel.discountType" class="form-control">
                                <option value="Percent">Ph·∫ßn trƒÉm (%)</option>
                                <option value="Fixed">S·ªë ti·ªÅn c·ªë ƒë·ªãnh (VNƒê)</option>
                            </select>
                        </div>
                    </div>

                    <div class="form-row">
                        <div class="form-group">
                            <label>Gi√° tr·ªã gi·∫£m</label>
                            <input type="number" name="value" [(ngModel)]="formModel.value" required
                                class="form-control">
                        </div>
                        <div class="form-group">
                            <label>ƒê∆°n t·ªëi thi·ªÉu</label>
                            <input type="number" name="minOrder" [(ngModel)]="formModel.minimumOrderAmount"
                                class="form-control">
                        </div>
                    </div>

                    <div class="form-row">
                        <div class="form-group">
                            <label>Ng√†y b·∫Øt ƒë·∫ßu</label>
                            <input type="datetime-local" name="startDate" [(ngModel)]="formModel.startDate" required
                                class="form-control">
                        </div>
                        <div class="form-group">
                            <label>Ng√†y k·∫øt th√∫c</label>
                            <input type="datetime-local" name="endDate" [(ngModel)]="formModel.endDate" required
                                class="form-control">
                        </div>
                    </div>

                    <div class="form-row">
                        <div class="form-group">
                            <label>Gi·ªõi h·∫°n s·ª≠ d·ª•ng (0 = V√¥ h·∫°n)</label>
                            <input type="number" name="usageLimit" [(ngModel)]="formModel.usageLimit"
                                class="form-control">
                        </div>
                        <div class="form-group checkbox-group">
                            <label>
                                <input type="checkbox" name="isActive" [(ngModel)]="formModel.isActive">
                                K√≠ch ho·∫°t ngay
                            </label>
                        </div>
                    </div>

                    <div class="modal-actions">
                        <button type="button" class="btn-cancel" (click)="cancelForm()">H·ªßy</button>
                        <button type="submit" class="btn-save"
                            [disabled]="!discountForm.valid && !formModel.appliesToProductId">L∆∞u</button>
                    </div>
                </form>
            </div>
        </div>
    </div>
</div>