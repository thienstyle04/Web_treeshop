<div class="admin-categories-page">
    <div class="page-content">
        <!-- Sidebar -->
        <aside class="filters-sidebar">
            <div class="filter-section">
                <h3>Danh m·ª•c</h3>
                <button class="add-category-btn" (click)="showAddModal = true">
                    + Th√™m m·ªõi
                </button>
            </div>

            <div class="filter-section">
                <h3>S·∫Øp x·∫øp</h3>
                <select>
                    <option value="newest">M·ªõi nh·∫•t</option>
                    <option value="name">T√™n A-Z</option>
                </select>
            </div>
        </aside>

        <!-- Main Content -->
        <main class="categories-main">
            <div class="categories-toolbar">
                <span class="result-count">
                    Hi·ªÉn th·ªã <strong>{{ categories().length }}</strong> danh m·ª•c
                </span>
                <div class="view-options">
                    <button class="active">
                        <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24"
                            fill="currentColor">
                            <rect x="3" y="3" width="7" height="7"></rect>
                            <rect x="14" y="3" width="7" height="7"></rect>
                            <rect x="14" y="14" width="7" height="7"></rect>
                            <rect x="3" y="14" width="7" height="7"></rect>
                        </svg>
                    </button>
                    <button>
                        <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24"
                            fill="currentColor">
                            <rect x="3" y="4" width="18" height="4"></rect>
                            <rect x="3" y="10" width="18" height="4"></rect>
                            <rect x="3" y="16" width="18" height="4"></rect>
                        </svg>
                    </button>
                </div>
            </div>

            @if (loading()) {
            <div class="categories-grid">
                @for (i of [1,2,3,4,5,6]; track i) {
                <div class="category-card skeleton">
                    <div class="skeleton-image"></div>
                    <div class="skeleton-content">
                        <div class="skeleton-text"></div>
                        <div class="skeleton-text short"></div>
                    </div>
                </div>
                }
            </div>
            } @else if (categories().length === 0) {
            <div class="empty-state">
                <span class="empty-icon">üìÅ</span>
                <h3>Ch∆∞a c√≥ danh m·ª•c n√†o</h3>
                <p>H√£y th√™m danh m·ª•c ƒë·∫ßu ti√™n</p>
                <button class="primary-btn" (click)="showAddModal = true">Th√™m danh m·ª•c</button>
            </div>
            } @else {
            <div class="categories-grid">
                @for (category of categories(); track category.id) {
                <a [routerLink]="['/admin/products']" [queryParams]="{category: category.id}" class="category-card">
                    <div class="card-image">
                        <div class="category-name-display">{{ category.name }}</div>
                        <div class="card-overlay">
                            <button class="quick-view-btn" (click)="editCategory(category, $event)">Ch·ªânh s·ª≠a</button>
                        </div>
                    </div>
                    <div class="card-content">
                        <p class="category-label">DANH M·ª§C #{{ category.id }}</p>
                        <h3 class="category-name">{{ category.name }}</h3>
                        <p class="category-desc">{{ category.description || 'Ch∆∞a c√≥ m√¥ t·∫£' }}</p>
                        <div class="card-footer">
                            <span class="url-handler">{{ category.urlHandler || 'ch∆∞a c√≥ url' }}</span>
                            <button class="delete-btn" (click)="confirmDelete(category, $event)">
                                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24"
                                    fill="none" stroke="currentColor" stroke-width="2">
                                    <polyline points="3 6 5 6 21 6"></polyline>
                                    <path
                                        d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2">
                                    </path>
                                </svg>
                            </button>
                        </div>
                    </div>
                </a>
                }
            </div>
            }
        </main>
    </div>

    <!-- Add/Edit Modal -->
    @if (showAddModal || showEditModal) {
    <div class="modal-overlay" (click)="closeModal()">
        <div class="modal" (click)="$event.stopPropagation()">
            <div class="modal-header">
                <h2>{{ showEditModal ? 'S·ª≠a danh m·ª•c' : 'Th√™m danh m·ª•c m·ªõi' }}</h2>
                <button class="close-btn" (click)="closeModal()">√ó</button>
            </div>
            <div class="modal-body">
                <div class="form-group">
                    <label>T√™n danh m·ª•c *</label>
                    <input type="text" [(ngModel)]="formData.name" placeholder="VD: C√¢y VƒÉn Ph√≤ng">
                </div>
                <div class="form-group">
                    <label>URL Handler</label>
                    <input type="text" [(ngModel)]="formData.urlHandler" placeholder="VD: cay-van-phong">
                </div>
                <div class="form-group">
                    <label>M√¥ t·∫£</label>
                    <textarea [(ngModel)]="formData.description" rows="3" placeholder="M√¥ t·∫£ danh m·ª•c..."></textarea>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn-secondary" (click)="closeModal()">H·ªßy</button>
                <button class="btn-primary" (click)="saveCategory()">
                    {{ showEditModal ? 'C·∫≠p nh·∫≠t' : 'Th√™m' }}
                </button>
            </div>
        </div>
    </div>
    }

    <!-- Delete Confirmation -->
    @if (showDeleteModal) {
    <div class="modal-overlay" (click)="showDeleteModal = false">
        <div class="modal delete-modal" (click)="$event.stopPropagation()">
            <div class="modal-body">
                <div class="delete-icon">‚ö†Ô∏è</div>
                <h3>X√°c nh·∫≠n x√≥a</h3>
                <p>B·∫°n c√≥ ch·∫Øc mu·ªën x√≥a "{{ categoryToDelete?.name }}"?</p>
            </div>
            <div class="modal-footer">
                <button class="btn-secondary" (click)="showDeleteModal = false">H·ªßy</button>
                <button class="btn-danger" (click)="deleteCategory()">X√≥a</button>
            </div>
        </div>
    </div>
    }
</div>